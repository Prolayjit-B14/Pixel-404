
const photos = [

    {
    src: 'asstes/photo1.jpg',
    title: 'The Right Turn',
    caption: 'Always take the right turn üîÑ',
    location: 'Krishnanagar, West Bengal, India',
    date: '2023-07-23',
    time: '17:37 IST',
    camera: 'Redmi Note 11 Pro+ 5G',
    category: 'Nature',
    tags: ['landscape', 'village', 'sky'],
    collection: 'Landscapes of Bengal',
    device: 'Redmi Note 11 Pro+ 5G, Xiaomi',
    sensor: '108 MP',
    lens: '16mm (Equivalent)',
    aperture: 'f/2.2',
    shutter: '1/689s',
    iso: '50',
    wb: 'Auto',
    flash: 'No Flash',
    mode: 'Wide | Natural Light | No Flash',
    editing: {
        app: 'MIUI Gallery Editor',
        exposure: 'Refined overall scene illumination using Brightness and Lightness.',
        tone: 'Increased Contrast, reduced Highlights (for cloud texture), and significantly lifted Shadows (for foreground detail).',
        color: 'Boosted Saturation and Vibrance for richer blues and greens.',
        detail: 'Applied Clarity and Sharpness to define textures in the clouds and grass.'
    },
    notes: 'Afternoon frame with balanced exposure, crisp sky, and natural contrast.'
   },
{
  src: 'asstes/photo2.jpg',
  title: 'Rhythm of the Waves',
  caption: 'Finding serenity in the rhythm of the waves üåä',
  location: 'Digha, West Bengal, India',
  date: '2024-09-08',
  time: '06:19 IST',
  camera: 'Redmi Note 11 Pro+ 5G',
  category: 'Nature',
  tags: ['ocean', 'sunrise', 'waves', 'rocks', 'golden-light'],
  collection: 'Digha Days',
  device: 'Redmi Note 11 Pro+ 5G, Xiaomi',
  sensor: '108 MP',
  lens: '24mm (Equivalent - Standard Wide)',
  aperture: 'f/1.84',
  shutter: '1/227s',
  iso: '50',
  wb: 'Auto',
  flash: 'No Flash',
  mode: 'Wide | Natural Light | No Flash',
  editing: {
    app: 'MIUI Gallery Editor',
    exposure: 'Minor adjustment to Brightness and Exposure to emphasize the early morning light.',
    tone: 'Increased Contrast and heavily reduced Highlights to preserve detail in the bright sea foam and sunlight.',
    color: 'Slightly warmed Color Temperature for the sunrise glow; boosted Vibrance for the ocean colors.',
    detail: 'Enhanced Clarity and Sharpness to define the texture of the rocks and the breaking waves.'
  },
  notes: 'The rising sun casts a golden glow on the sea, highlighting the battle between the ocean waves and the rugged rocks of Digha‚Äôs beach.'
},
{
  src: 'asstes/photo3.jpg',
  title: 'Light and Shadow',
  caption: 'The smallest light can cast the longest shadow üåëüåìüåï',
  location: 'Krishnanagar, West Bengal, India',
  date: '2025-10-20',
  time: '17:50 IST',
  camera: 'Redmi Note 11 Pro+ 5G',
  category: 'Festival',
  tags: ['candlelight', 'bokeh', 'shadow', 'warm-tone', 'contrast'],
  collection: 'Diwali Lights',
  device: 'Redmi Note 11 Pro+ 5G, Xiaomi',
  sensor: '108 MP',
  lens: '24mm (Equivalent)',
  aperture: 'f/1.84',
  shutter: '1/60s',
  iso: '160',
  wb: 'Auto',
  flash: 'No Flash',
  mode: 'Pro | Low Light | No Flash',
  editing: {
    app: 'MIUI Gallery Editor',
    exposure: 'Adjusted Exposure, Brightness, and Lightness for optimal warmth and visibility.',
    tone: 'Increased Contrast, reduced Highlights, and lifted Shadows for a dramatic glow.',
    aesthetics: 'Applied a subtle Vignette to draw focus, and adjusted Dark/Light Range for overall depth.',
    color: 'Boosted Vibrance and targeted Saturation on the background bokeh.',
    detail: 'Enhanced Clarity and Sharpness to define the flame and wax texture.'
  },
  notes: 'A low-light capture with the warm glow of the candle flame contrasting beautifully against the colorful background illumination.'
},
{
  src: 'asstes/photo4.jpg',
  title: 'Light of Goddess',
  caption: 'Light of the Goddess Maa Durga ‚ù§Ô∏è',
  location: 'Krishnanagar Rajbari, West Bengal, India',
  date: '2025-09-30',
  time: '13:17 IST',
  camera: 'Redmi Note 11 Pro+ 5G',
  category: 'Festival',
  tags: ['durga-puja', 'goddess', 'temple-light', 'low-light', 'culture'],
  collection: 'Durga Puja Special',
  device: 'Redmi Note 11 Pro+ 5G, Xiaomi',
  sensor: '108 MP',
  lens: '24mm (Equivalent - Standard Wide)',
  aperture: 'f/1.84',
  shutter: '1/60s',
  iso: '60',
  wb: 'Auto',
  flash: 'No Flash',
  mode: 'Pro | Low Light | No Flash',
  editing: {
    app: 'MIUI Gallery Editor',
    exposure: 'Reduced Highlights (for chandelier definition) and lifted Shadows (for deity visibility).',
    tone: 'Increased Contrast and adjusted Dark/Light Range for a dramatic, moody look.',
    color: 'Warmed Color Temperature while selectively boosting Saturation in the deity shrine‚Äôs backdrop.',
    detail: 'Enhanced Clarity and Sharpness on the crystal work and gold carvings.'
  },
  notes: 'An atmospheric capture portraying the majestic chandelier illuminating the divine calm and intricate artistry of Maa Durga‚Äôs shrine.'
},
{
  src: 'asstes/photo5.jpg',
  title: 'Golden Reflection',
  caption: 'Holding the last warmth of the day, a tranquil surface mirrors the sun"s fiery kissüåÖ',
  location: 'Eco Park, Kolkata, West Bengal, India',
  date: '2024-12-26',
  time: '16:17 IST',
  camera: 'Redmi Note 11 Pro+ 5G',
  category: 'Nature',
  tags: ['golden-hour', 'reflection', 'sunset', 'serene', 'water'],
  collection: 'Landscapes of Bengal',
  device: 'Redmi Note 11 Pro+ 5G, Xiaomi',
  sensor: '108 MP',
  lens: '24mm (Equivalent)',
  aperture: 'f/1.89',
  shutter: '1/699s',
  iso: '50',
  wb: 'Auto',
  flash: 'No Flash',
  mode: 'Pro | Golden Hour | No Flash',
  editing: {
    app: 'MIUI Gallery Editor',
    exposure: 'Adjusted Exposure and Brightness to enhance the glow of the setting sun.',
    tone: 'Increased Contrast to separate the sky and water, and reduced Highlights to preserve detail in the sun and its reflection.',
    aesthetics: 'Applied a subtle crop to emphasize the horizon line and reflection.',
    color: 'Boosted Vibrance and Warmth to intensify the golden-hour tones in the sky and water.',
    detail: 'Enhanced Clarity and Sharpness slightly to define the distant shoreline.'
  },
  notes: 'A serene winter sunset at Eco Park, capturing the rich orange glow and soft reflection of the sun across the calm water surface.'
},

];

let state = {view:'masonry', filter:'all', search:'', filtered:[], panelOpen:false, idx:0};

// Theme with smooth transitions
const theme = localStorage.getItem('theme') || 'light';
document.documentElement.setAttribute('data-theme', theme);
document.getElementById('themeBtn').innerHTML = theme === 'dark' ? '<i class="fas fa-sun"></i>' : '<i class="fas fa-moon"></i>';
document.getElementById('themeBtn').onclick = () => {
  const curr = document.documentElement.getAttribute('data-theme');
  const next = curr === 'dark' ? 'light' : 'dark';
  document.documentElement.setAttribute('data-theme', next);
  document.getElementById('themeBtn').innerHTML = next === 'dark' ? '<i class="fas fa-sun"></i>' : '<i class="fas fa-moon"></i>';
  localStorage.setItem('theme', next);
};

// Filters
const filterDef = [
  {id:'all', label:'All'},
  {id:'Nature', label:'Nature'},
  {id:'Festival', label:'Festival'},
  {id:'location:Krishnanagar', label:'Krishnanagar'},
  {id:'location:Kolkata', label:'Kolkata'},
  {id:'collection:Landscapes of Bengal', label:'Landscapes of Bengal'},
  {id:'collection:Durga Puja Special', label:'Durga Puja Special'},
  {id:'collection:Diwali Lights', label:'Diwali Lights'},
  {id:'collection:Digha Days', label:'Digha Days'},
];

function initFilters() {
  const cont = document.getElementById('filters');
  filterDef.forEach(f => {
    const btn = document.createElement('button');
    btn.className = 'filter-btn' + (f.id === 'all' ? ' active' : '');
    btn.dataset.filter = f.id;
    const count = getCount(f.id);
    btn.innerHTML = `${f.label} <span class="count">(${count})</span>`;
    btn.onclick = () => {
      document.querySelectorAll('.filter-btn').forEach(b => b.classList.remove('active'));
      btn.classList.add('active');
      state.filter = f.id;
      applyFilters();
    };
    cont.appendChild(btn);
  });
}

function getCount(fid) {
  if (fid === 'all') return photos.length;
  if (fid.startsWith('location:')) {
    const loc = fid.split(':')[1];
    return photos.filter(p => p.location.includes(loc)).length;
  }
  if (fid.startsWith('collection:')) {
    const col = fid.split(':')[1];
    return photos.filter(p => p.collection === col).length;
  }
  return photos.filter(p => p.category === fid).length;
}

// Search
document.getElementById('searchInput').oninput = (e) => {
  state.search = e.target.value.toLowerCase();
  applyFilters();
};

// View Toggle
document.querySelectorAll('.view-btn').forEach(btn => {
  btn.onclick = () => {
    document.querySelectorAll('.view-btn').forEach(b => b.classList.remove('active'));
    btn.classList.add('active');
    state.view = btn.dataset.view;
    render();
  };
});

function applyFilters() {
  state.filtered = photos.filter(p => {
    let match = true;
    if (state.filter !== 'all') {
      if (state.filter.startsWith('location:')) {
        const loc = state.filter.split(':')[1];
        match = p.location.includes(loc);
      } else if (state.filter.startsWith('collection:')) {
        const col = state.filter.split(':')[1];
        match = p.collection === col;
      } else {
        match = p.category === state.filter;
      }
    }
    if (match && state.search) {
      match = p.title.toLowerCase().includes(state.search) ||
              p.location.toLowerCase().includes(state.search) ||
              p.tags.some(t => t.includes(state.search)) ||
              (p.collection && p.collection.toLowerCase().includes(state.search));
    }
    return match;
  });
  render();
}

function render() {
  const cont = document.getElementById('gallery');
  cont.style.opacity = '0';
  setTimeout(() => {
    cont.innerHTML = '';
    if (state.filtered.length === 0) {
      cont.innerHTML = '<div class="no-results">No photos found</div>';
    } else if (state.view === 'timeline') {
      renderTimeline(cont);
    } else {
      const wrap = document.createElement('div');
      wrap.className = state.view;
      state.filtered.forEach((p, i) => wrap.appendChild(createCard(p, i)));
      cont.appendChild(wrap);
    }
    cont.style.opacity = '1';
  }, 300);
}

function createCard(p, idx) {
  const card = document.createElement('div');
  card.className = 'photo-card';
  card.innerHTML = `
    <div class="img-wrap">
      <img src="${p.src}" alt="${esc(p.title)}" loading="lazy">
      ${p.collection ? `<div class="badge">${esc(p.collection)}</div>` : ''}
    </div>
    <div class="card-info">
      <div class="card-title">${esc(p.title)}</div>
      <div class="card-caption">${esc(p.caption)}</div>
      <div class="card-meta">
        <span>üìÖ ${fmtDate(p.date)}</span>
        <span>üìç ${esc(p.location)}</span>
      </div>
    </div>
  `;
  card.onclick = () => openLightbox(photos.indexOf(p));
  return card;
}

function renderTimeline(cont) {
  const groups = {};
  state.filtered.forEach(p => {
    const d = new Date(p.date);
    const key = `${d.getFullYear()}-${String(d.getMonth()+1).padStart(2,'0')}`;
    const label = d.toLocaleDateString('en-US', {year:'numeric', month:'long'});
    if (!groups[key]) groups[key] = {label, items:[]};
    groups[key].items.push(p);
  });
  const wrap = document.createElement('div');
  wrap.className = 'timeline';
  Object.keys(groups).sort().reverse().forEach(k => {
    const sect = document.createElement('div');
    sect.className = 'timeline-group';
    sect.innerHTML = `<h3>${groups[k].label}</h3>`;
    const grid = document.createElement('div');
    grid.className = 'timeline-grid';
    groups[k].items.forEach(p => grid.appendChild(createCard(p)));
    sect.appendChild(grid);
    wrap.appendChild(sect);
  });
  cont.appendChild(wrap);
}

// Lightbox with better zoom
let zoomed = false;
function openLightbox(idx) {
  state.idx = idx;
  state.panelOpen = false;
  zoomed = false;
  const p = photos[idx];
  const img = document.getElementById('lbImg');
  img.src = p.src;
  img.alt = p.title;
  img.classList.remove('with-panel', 'zoomed');
  document.getElementById('lbTitle').textContent = p.title;
  document.getElementById('lbCaption').textContent = p.caption;
  document.getElementById('lbInfo').classList.remove('hidden');
  populatePanel(p);
  document.getElementById('panel').classList.remove('open');
  document.getElementById('lbMain').classList.remove('with-panel');
  document.getElementById('closeBtn').classList.remove('shifted');
  document.getElementById('nextBtn').classList.remove('shifted');
  document.getElementById('lightbox').classList.add('open');
  document.body.style.overflow = 'hidden';
}

function closeLightbox() {
  document.getElementById('lightbox').classList.remove('open');
  document.body.style.overflow = '';
  state.panelOpen = false;
  zoomed = false;
}

function togglePanel() {
  state.panelOpen = !state.panelOpen;
  const panel = document.getElementById('panel');
  const main = document.getElementById('lbMain');
  const img = document.getElementById('lbImg');
  const info = document.getElementById('lbInfo');
  const close = document.getElementById('closeBtn');
  const next = document.getElementById('nextBtn');
  if (state.panelOpen) {
    info.classList.add('hidden');
    img.classList.add('with-panel');
    panel.classList.add('open');
    main.classList.add('with-panel');
    close.classList.add('shifted');
    next.classList.add('shifted');
  } else {
    info.classList.remove('hidden');
    img.classList.remove('with-panel');
    panel.classList.remove('open');
    main.classList.remove('with-panel');
    close.classList.remove('shifted');
    next.classList.remove('shifted');
  }
}

function navigate(dir) {
  state.idx = (state.idx + dir + photos.length) % photos.length;
  openLightbox(state.idx);
}

function populatePanel(p) {
  const tags = p.tags.map(t => `<span style="padding:5px 10px;background:var(--hover);border-radius:8px;font-size:0.8rem;border:1px solid var(--border)">#${t}</span>`).join('');
  document.getElementById('panelBody').innerHTML = `
    <div class="caption-full">${esc(p.caption)}</div>
    <div class="detail-section">
      <div class="section-title"><i class="fas fa-map-marker-alt"></i> Location & Time</div>
      <div class="detail-row"><span class="detail-label">Date</span><span class="detail-value">${fmtDate(p.date)}</span></div>
      <div class="detail-row"><span class="detail-label">Time</span><span class="detail-value">${esc(p.time)}</span></div>
      <div class="detail-row"><span class="detail-label">Location</span><span class="detail-value">${esc(p.location)}</span></div>
      <div class="detail-row"><span class="detail-label">Collection</span><span class="detail-value">${esc(p.collection)}</span></div>
      <div class="detail-row"><span class="detail-label">Catagory</span><span class="detail-value">${esc(p.category)}</span></div>
    </div>
    <div class="detail-section">
      <div class="section-title"><i class="fas fa-camera"></i> Camera Settings</div>
      <div class="detail-row"><span class="detail-label">Device</span><span class="detail-value">${esc(p.device)}</span></div>
      <div class="detail-row"><span class="detail-label">Sensor</span><span class="detail-value">${esc(p.sensor)}</span></div>
      <div class="detail-row"><span class="detail-label">Lens</span><span class="detail-value">${esc(p.lens)}</span></div>
      <div class="detail-row"><span class="detail-label">Aperture</span><span class="detail-value">${esc(p.aperture)}</span></div>
      <div class="detail-row"><span class="detail-label">Shutter</span><span class="detail-value">${esc(p.shutter)}</span></div>
      <div class="detail-row"><span class="detail-label">ISO</span><span class="detail-value">${esc(p.iso)}</span></div>
    </div>
    <div class="detail-section">
      <div class="section-title"><i class="fas fa-palette"></i> Post-Processing</div>
      <div class="detail-row"><span class="detail-label">Software</span><span class="detail-value">${esc(p.editing.app)}</span></div>
      <div class="detail-row"><span class="detail-label">Exposure</span><span class="detail-value">${esc(p.editing.exposure)}</span></div>
      <div class="detail-row"><span class="detail-label">Color</span><span class="detail-value">${esc(p.editing.color)}</span></div>
      <div class="detail-row"><span class="detail-label">Tone</span><span class="detail-value">${esc(p.editing.tone)}</span></div>
      <div class="detail-row"><span class="detail-label">Tone</span><span class="detail-value">${esc(p.editing.tone)}</span></div>
      <div class="detail-row"><span class="detail-label">Aesthetics</span><span class="detail-value">${esc(p.editing.aesthetics)}</span></div>
      <div class="detail-row"><span class="detail-label">Detail</span><span class="detail-value">${esc(p.editing.detail)}</span></div>

    </div>
    <div class="detail-section">
      <div class="section-title"><i class="fas fa-tags"></i> Tags</div>
      <div style="display:flex;gap:8px;flex-wrap:wrap">${tags}</div>
    </div>
    <div class="detail-section">
      <div class="section-title"><i class="fas fa-pen"></i> Notes</div>
      <div style="font-size:0.85rem;line-height:1.6;color:var(--text)">${esc(p.notes)}</div>
    </div>
    <div class="detail-section">
      <div class="section-title"><i class="fas fa-share-alt"></i> Share</div>
      <div class="share-grid">
        <button class="share-btn" onclick="share('500px')"><i class="fab fa-500px"></i> 500px</button>
        <button class="share-btn" onclick="share('instagram')"><i class="fab fa-instagram"></i> Instagram</button>
                <button class="share-btn" onclick="share('pinterest')"><i class="fab fa-pinterest"></i> Pinterest</button>
        <button class="share-btn" onclick="share('facebook')"><i class="fab fa-facebook"></i> Facebook</button>
                <button class="share-btn" onclick="share('behance')"><i class="fab fa-behance"></i> Behance</button>
        <button class="share-btn" onclick="share('twitter')"><i class="fab fa-twitter"></i> Twitter</button>
        <button class="share-btn" onclick="share('whatsapp')"><i class="fab fa-whatsapp"></i> WhatsApp</button>
        <button class="share-btn" onclick="copyUrl()"><i class="fas fa-link"></i> Copy Link</button>
      </div>
    </div>
  `;
}

function downloadWithWatermark() {
  const p = photos[state.idx];
  const canvas = document.createElement('canvas');
  const ctx = canvas.getContext('2d');
  const img =   new Image();
  img.crossOrigin = 'anonymous';
  img.onload = () => {
    canvas.width = img.width;
    canvas.height = img.height;
    
    // Draw main image
    ctx.drawImage(img, 0, 0);
    
    // Add semi-transparent overlay at bottom
    const overlayHeight = 120;
    const gradient = ctx.createLinearGradient(0, canvas.height - overlayHeight, 0, canvas.height);
    gradient.addColorStop(0, 'rgba(0,0,0,0.3)');
    gradient.addColorStop(1, 'rgba(0,0,0,0.8)');
    ctx.fillStyle = gradient;
    ctx.fillRect(0, canvas.height - overlayHeight, canvas.width, overlayHeight);
    
    // Add branding with modern styling
    ctx.textAlign = 'left';
    
    // Logo/Brand
    ctx.font = 'bold 56px Montserrat';
    ctx.fillStyle = '#ea580c';
    ctx.fillText('PIXEL 404', 40, canvas.height - 70);
    
    // Photo title
    ctx.font = '36px Inter';
    ctx.fillStyle = 'rgba(255,255,255,0.95)';
    ctx.fillText(p.title, 40, canvas.height - 30);
    
    // Right side info
    ctx.textAlign = 'right';
    ctx.font = '28px Inter';
    ctx.fillStyle = 'rgba(255,255,255,0.85)';
    ctx.fillText(p.location, canvas.width - 40, canvas.height - 50);
    ctx.fillText('¬© Prolayjit Biswas', canvas.width - 40, canvas.height - 20);
    
    // Convert to blob and download
    canvas.toBlob(blob => {
      const url = URL.createObjectURL(blob);
      const a = document.createElement('a');
      a.href = url;
      a.download = `${p.title.replace(/[^a-z0-9]/gi,'_')}_Pixel404.jpg`;
      a.click();
      URL.revokeObjectURL(url);
    }, 'image/jpeg', 0.95);
  };
  img.src = p.src;
}

function share(platform) {
  const p = photos[state.idx];
  const url = encodeURIComponent(window.location.href + '?photo=' + state.idx);
  const text = encodeURIComponent(`${p.title} - ${p.caption}`);
  const urls = {
    facebook: `https://facebook.com/sharer/sharer.php?u=${url}`,
    twitter: `https://twitter.com/intent/tweet?text=${text}&url=${url}`,
    pinterest: `https://pinterest.com/pin/create/button/?url=${url}&description=${text}`,
    whatsapp: `https://api.whatsapp.com/send?text=${text} ${url}`,
    instagram: `https://www.instagram.com/your_profile_name/`,
    '500px': `https://500px.com/pro_lay04`,
    behance: `https://www.behance.net/your_username`,
  };
  
  if (urls[platform]) window.open(urls[platform], '_blank', 'width=600,height=400');
}

function copyUrl() {
  const url = window.location.href + '?photo=' + state.idx;
  navigator.clipboard.writeText(url).then(() => {
    alert('‚úì Link copied to clipboard!');
  });
}

// Contact form handler
function handleSubmit(e) {
  e.preventDefault();
  alert('Thank you for your message! I\'ll get back to you soon. üìß');
  e.target.reset();
}

// Image Zoom with better controls
document.getElementById('lbImg').onclick = (e) => {
  if (state.panelOpen) return; // Don't zoom when panel is open
  const img = document.getElementById('lbImg');
  zoomed = !zoomed;
  if (zoomed) {
    img.classList.add('zoomed');
    // Zoom to cursor position
    const rect = img.getBoundingClientRect();
    const x = (e.clientX - rect.left) / rect.width;
    const y = (e.clientY - rect.top) / rect.height;
    img.style.transformOrigin = `${x * 100}% ${y * 100}%`;
  } else {
    img.classList.remove('zoomed');
    img.style.transformOrigin = 'center';
  }
};

// Events
document.getElementById('closeBtn').onclick = closeLightbox;
document.getElementById('prevBtn').onclick = () => navigate(-1);
document.getElementById('nextBtn').onclick = () => navigate(1);
document.getElementById('detailsBtn').onclick = togglePanel;
document.getElementById('panelClose').onclick = togglePanel;
document.getElementById('downloadBtn').onclick = downloadWithWatermark;

window.onkeydown = (e) => {
  if (document.getElementById('lightbox').classList.contains('open')) {
    if (e.key === 'Escape') {
      if (zoomed) {
        zoomed = false;
        document.getElementById('lbImg').classList.remove('zoomed');
      } else if (state.panelOpen) {
        togglePanel();
      } else {
        closeLightbox();
      }
    }
    if (e.key === 'ArrowLeft') navigate(-1);
    if (e.key === 'ArrowRight') navigate(1);
    if (e.key === 'd' || e.key === 'D') togglePanel();
    if (e.key === 'z' || e.key === 'Z') document.getElementById('lbImg').click();
  }
};

document.getElementById('lightbox').onclick = (e) => {
  if (e.target.id === 'lightbox') closeLightbox();
};

// Smooth scroll for footer links
document.querySelectorAll('a[href^="#"]').forEach(anchor => {
  anchor.addEventListener('click', function (e) {
    const href = this.getAttribute('href');
    if (href !== '#') {
      e.preventDefault();
      const target = document.querySelector(href);
      if (target) {
        target.scrollIntoView({
          behavior: 'smooth',
          block: 'start'
        });
      }
    }
  });
});

// Utils
function esc(s) {
  return String(s).replace(/[&<>"']/g, c => ({'&':'&amp;','<':'&lt;','>':'&gt;','"':'&quot;',"'":'&#39;'}[c]));
}
function fmtDate(d) {
  return new Date(d).toLocaleDateString('en-US', {year:'numeric', month:'short', day:'numeric'});
}

// Init
state.filtered = photos;
document.getElementById('photoCount').textContent = photos.length;
initFilters();
render();

// Direct link support
const params = new URLSearchParams(window.location.search);
if (params.has('photo')) {
  const idx = parseInt(params.get('photo'));
  if (idx >= 0 && idx < photos.length) setTimeout(() => openLightbox(idx), 500);
}

// Add scroll reveal animation
const observerOptions = {
  threshold: 0.1,
  rootMargin: '0px 0px -100px 0px'
};

const observer = new IntersectionObserver((entries) => {
  entries.forEach(entry => {
    if (entry.isIntersecting) {
      entry.target.style.opacity = '1';
      entry.target.style.transform = 'translateY(0)';
    }
  });
}, observerOptions);

// Observe photo cards after render
function observeCards() {
  document.querySelectorAll('.photo-card').forEach((card, i) => {
    card.style.opacity = '0';
    card.style.transform = 'translateY(30px)';
    card.style.transition = `all 0.6s cubic-bezier(0.4, 0, 0.2, 1) ${i * 0.05}s`;
    observer.observe(card);
  });
}

// Call after initial render
setTimeout(observeCards, 100);

// Re-observe after filter/search changes
const originalRender = render;
render = function() {
  originalRender();
  setTimeout(observeCards, 100);
};